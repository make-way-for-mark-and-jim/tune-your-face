<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Canvas Plot Test</title>
    <style type='text/css'>
      html, body {
        padding-left: 25px;
        background-color: #222;
        color: #EEE;
        font-family: sans-serif;
      }

      h1 {
        font-size: 36px;
      }

      canvas {
        background-color: #CCC;
      }
    </style>
  </head>
  <body>
    <h1>Plot Test</h1>
    <canvas id="canvas" width="400" height="300"></canvas>

    <script type="text/javascript">

      var height = 300;
      var width  = 400;

      var canvas  = document.getElementById('canvas');
      var ctx     = canvas.getContext('2d');
      var penSize = 2;

      var history         = [];
      var historySize     = 256; //Power of 2 so it looks smart
      var historyPointer  = 0;
      var penX            = 3/4 * width;

      function render(time) {

        var t_sec = time / 1000;
        var y = calcY(t_sec);
        var index = historyPointer++ % historySize;
        history[index] = y;

        ctx.fillStyle = 'rgb(200, 60, 60)';
        ctx.clearRect(0, 0, width, height);

        drawXAxis();
        drawWave(index);

      }

      function calcY(t) {
        var f = .5; //Hz
        var w = 2 * Math.PI * f;
        var A = 50;
        var y = A * Math.sin(w * t) + height / 2;

        return y;
      }

      function drawWave(index) {
        for(var i = 0; i < historySize; i++) {

            var yIndex = (index - i) % historySize;
            if (yIndex < 0) {
              yIndex = historySize + yIndex;
            }

            var _x = penX * (1 - i / historySize);
            var _y = history[yIndex];

            ctx.beginPath();
            ctx.arc(_x, _y, penSize, 0, 2 * Math.PI, true);
            ctx.closePath();
            ctx.fill();
        }
      }

      function drawXAxis() {
        ctx.beginPath();
        ctx.strokeStyle = 'rgba(0, 0, 0, .4)';

        // Add 0.5 to each y value to get a truly 1px thick line
        // So dumb.
        ctx.moveTo(0, height/2 + .5);
        ctx.lineTo(width, height/2 + .5);
        ctx.stroke();
        ctx.closePath();
      }

      // Get this ball of wax rolling and extra waxy
      (function animationLoop(time) {
        window.requestAnimationFrame(animationLoop);
        render(time);
      })();

    </script>
  </body>
</html>
